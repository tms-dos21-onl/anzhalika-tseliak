Выполнение с помощью VMware Fusion на Ubuntu

Создать новый виртуальный жёсткий диск, присоеденить его к VM, создать раздел (partition) и инициализировать на нём файловую системую.
-
просмотр доступных дисков:

``` bash
lsblk 
```
![](/HW2/assets/1-1.png) 

Создание диска:  

![](/HW2/assets/1-2.png) 
![](/HW2/assets/1-3.png)  
![](/HW2/assets/1-4.png) 

Проверка:

``` bash
lsblk 
```
![](/HW2/assets/1-5.png) 

Создание раздела с помощью утилиты fdisk:

``` bash
sudo fdisk /dev/nvme0n2  #Утилита запрашивает параметры 
```
>Добавление нового раздела - n
>
>Выбор основного типа - p
>
>Номер раздела - 1
>
>Первый сектор - 2048
>
>Последний сектор - +10G
>
>Запись - w
>

Создание файловой системы:

``` bash
sudo mkfs.ext4 /dev/nvme0n2
```
![](/HW2/assets/1-6.png) 


Смонтировать директорию /mnt/home на только что созданный раздел.
-
Создание точки монтирования:

``` bash
sudo mkdir /mnt/home 
```
Монтирование:

``` bash
sudo mount /dev/nvme0n2 /mnt/home
```
 Проверка:

``` bash
cat /proc/mounts | grep nvme0n2
```
![](/HW2/assets/2-1.png)  

Создать нового пользователя penguin с home-директорией /mnt/home/penguin.
-
Создание:

``` bash
sudo useradd  -m -d  /mnt/home/penguin  penguin  # -m, —create-home ; -d , —home-dir
```
Переключение на юзера penguin:

``` bash
su penguin
```
Проверка:

``` bash
echo $HOME
```
![](/HW2/assets/3-1.png)  

Создать новую группу пользователей birds, перенести в нее пользователя penguin.
-
Создание группы:

``` bash
sudo groupadd birds
```

Добавление пользователя:

``` bash
sudo usermod -a -G birds penguin  # -a —добавление пользователя  -G —указание группы  или -aG
```
Проверка:

``` bash
cat /etc/group | grep penguin
```
![](/HW2/assets/4-1.png)  

Cоздать директорию /var/wintering и выдать права на нее только группе birds.
-
Создание директории:

``` bash
mkdir /var/wintering
```

Смена владельца:
 
``` bash
sudo chown :birds /var/wintering
```
 Проверка текущих прав:

``` bash
ls -l /var/ | grep wintering
```
![](/HW2/assets/5-2.png)  

Изменение прав для всех кроме группы:

``` bash
sudo chmod uo-rwx /var/wintering
```

Выдача прав группе:

``` bash
sudo chmod g+rwx /var/wintering
```
Проверка:

``` bash
ls -l /var/ | grep wintering
```
![](/HW2/assets/5-3.png)  

Установить ntpd (или chrony) и разрешить пользователю penguin выполнять команду systemctl restart chronyd (нужны права Больше узнать о том, что такое NTP и почему он важен.
-

>NTP — это протокол, который помогает синхронизировать время устройств (компьютеров, серверов, коммутаторов, маршрутизаторов) в сети.
NTP важен,если нужно администрировать большое количество компьютеров, серверов и других устройств, которые должны работать с одинаковым временем.

>Примеры:
Совместная работа компьютеров в локальной сети — если время на компьютерах будет различаться, это может привести к сбоям  
Eсли одна база данных обслуживается с нескольких компьютеров, они должны чётко синхронизироваться во времени, иначе запрос одного компьютера может прилететь из будущего, а реальный запрос из будущего попасть в прошлое  
Eсли использовать двойную аутентификацию,то с неправильным временем будет выдан неправильный код, и аутентификация не пройдёт.

Установка:

``` bash
sudo apt install chrony
```
![](/HW2/assets/6-1.png)   
Добавление пользователя penguin в sudoers:

``` bash
sudo visudo
```

Добавить в файл:

``` bash
penguin  ALL=(ALL:ALL) ALL
``` 
![](/HW2/assets/6-2.png)  
Выполнение команды через юзера penguin:

``` bash
sudo systemctl restart chronyd 
```
Проверка:

``` bash
sudo journalctl | grep chronyd | less #less дает возможность перемещения по выводу на серверной ubuntu
```


Вывод команды iostat -x в последней колонке показывает загрузку дисков в процентах. Откуда утилита это понимает?
Достаточно ли вывода команды iostat -x для того, чтобы оценить реальную нагрузку на диски, или нужны дополнительные условия или ключи?
-
>iostat собирает данные из файловой системы proc,в таких каталогах как  /proc/stat и создает отчеты с момента загрузки системы и до выполнения команды. Чтобы утилита автоматически обновляла данные каждую секунду, необходимо добавить интервал,определяемый в секундах и использовать опцию -y чтобы отображать статистику с момента запуска утилиты, а не системы 

``` bash
iostat -xy 1 # -x -отображать расширенную статистику
```
![](/HW2/assets/7-1.png) 


Подумать, что сделает команда chmod -x $(which chmod). Выполнить её на виртуальной машине и вернуть всё как было не прибегая к скачиванию\копированию chmod с другого хоста.

>Команда chmod -x $(which chmod) ставит запрет на использование chmod.  

>chmod -изменение прав доступа

>-x  -ключ исполнение

>$()  -подстановка вывода команды

>which  -местонахождение исполняемого файла команды

![](/HW2/assets/8-1.png) 
![](/HW2/assets/8-2.png) 

Мне удалось найти статью с разными вариантами решения проблемы из [этой](https://www.networkworld.com/article/945104/what-can-you-do-when-you-cant-chmod-chmod.html "") полезной  статьи и выбрала несколько из них. 

Первый вариант - с помощью команды setfacl ,которая дает возможность установить права владельца.После этого мы можем использовать команду chmod для установки остальных прав.


Переход в директорию /bin ,содержащую в себе исполняемые файлы:
``` bash 
cd /bin
```
Проверка прав: 

``` bash 
ls -l chmod
```  
Выдача прав владельца с помощью setfacl:

``` bash 
setfacl -m u::rx chmod
```
Выдача прав для chmod:

```bash
chmod 755 chmod
```
Проверка:

``` bash 
ls -l chmod
```  

![](/HW2/assets/8-3.png) 

Второй вариант - с помощью команды rsync,которая используется для перемещения файлов между системами и также локально  дает возможность назначать права на новые файлы.

Просмотр прав:  

``` bash 
ls -l /bin/chmod
```  
Копирование chmod в /tmp c правом выполнения копирования:  

``` bash 
rsync chmod /tmp/chmod --chmod=ugo+x
```  
Проверка копии:  

``` bash 
ls -l /tmp/chmod
```  
Перезапись исходного файла:

``` bash 
mv /tmp/chmod /bin
```  
![](/HW2/assets/8-4.png) 


